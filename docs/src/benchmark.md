# Benchmarks
The benchmarks are generated by the GitHub Actions. 
```@setup benchmark1
using InteractiveUtils, Pkg
```
```@repl benchmark1
versioninfo()
Pkg.status()
```

## Package loading
The precompilation is very slow since the package reads many `json` files and build sorting methods based on them.
```@repl benchmark1
@time Pkg.precompile("SwapSort")
```

## Same type (type-stable)
When sorting variables of the same type, `swapsort` has longer compilation time but from .01x to .2x runtime depending on the sorting size. To save the build time of the doc, this section only contains a simplified benchmark. 
```@setup benchmark2
using SwapSort, StaticArrays, PlotlyLight, BenchmarkTools, PlotlyDocumenter
BenchmarkTools.DEFAULT_PARAMETERS.seconds = 0.5
samples = [1,2,4,8,16,32,64]
swapsorttime = zeros(7)
svectortime = zeros(7)
vectortime = zeros(7)
```
We first generate 64 random variables:
```@example benchmark2
a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Ja,Fe,Ma,Ap,My,Ju,Jl,Au,Se,Oc,No,De = rand(64)
```
Then we sort ``N`` of them and benchmark, where ``N=1,...,64``. To save the build time of the doc, this section only benchmarks ``N=1,2,4,8,16,32,64``. 3 sorting routines are benchmarked:
- SwapSort: use `SwapSort.swapsort` to sort variables. Returns a sorted `Tuple`.
- StaticArrays: use `StaticArrays.SVector` to pack the variables and then sort the `SVector`. StaticArrays.jl has a built-in bitonic sort for the purpose. Returns a sorted `SVector` which has a field of sorted `NTuple`.
- Base: pack the variables into a `Vector` and use `Base.sort!`. Returns a sorted `Vector`.

The full benchmark can run from [this script](https://github.com/putianyi889/SwapSort.jl/blob/master/scripts/bench_var_sorting.jl). We use `@elapsed` to get the first-time sort which is mostly compilation time. Then we use `BenchmarkTools.@belapsed` to get the actual runtime.

### Compilation
```@example benchmark2
swapsorttime[1] = @elapsed swapsort(a) # hide
swapsorttime[2] = @elapsed swapsort(a,b) # hide
swapsorttime[3] = @elapsed swapsort(a,b,c,d) # hide
swapsorttime[4] = @elapsed swapsort(a,b,c,d,e,f,g,h) # hide
swapsorttime[5] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p) # hide
swapsorttime[6] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F) # hide
swapsorttime[7] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Ja,Fe,Ma,Ap,My,Ju,Jl,Au,Se,Oc,No,De) # hide

svectortime[1] = @elapsed sort(SVector(a)) # hide
#= Do the same thing. Lines are hidden=# # hide
svectortime[2] = @elapsed sort(SVector(a,b)) # hide
svectortime[3] = @elapsed sort(SVector(a,b,c,d)) # hide
svectortime[4] = @elapsed sort(SVector(a,b,c,d,e,f,g,h)) # hide
svectortime[5] = @elapsed sort(SVector(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p)) # hide
svectortime[6] = @elapsed sort(SVector(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F)) # hide
svectortime[7] = @elapsed sort(SVector(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Ja,Fe,Ma,Ap,My,Ju,Jl,Au,Se,Oc,No,De)) # hide

vectortime[1] = @elapsed sort!([a]) # hide
#= Do the same thing. Lines are hidden=# # hide
vectortime[2] = @elapsed sort!([a,b]) # hide
vectortime[3] = @elapsed sort!([a,b,c,d]) # hide
vectortime[4] = @elapsed sort!([a,b,c,d,e,f,g,h]) # hide
vectortime[5] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]) # hide
vectortime[6] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F]) # hide
vectortime[7] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Ja,Fe,Ma,Ap,My,Ju,Jl,Au,Se,Oc,No,De]) # hide

thisplot = plot.scatter(x=samples, y=swapsorttime, name="SwapSort").scatter(x=samples,y=svectortime, name="StaticArrays").scatter(x=samples,y=vectortime, name="Base") # hide
thisplot.layout.xaxis = ( # hide
    type = "log", # hide
    dtick = log10(2), # hide
    title = "N" # hide
) # hide
thisplot.layout.yaxis = ( # hide
    type = "log", # hide
    dtick = 1, # hide
    exponentformat = "power", # hide
    title = "Compilation" # hide
) # hide
to_documenter(thisplot) # hide
```

### Runtime
```@example benchmark2
swapsorttime[1] = @belapsed swapsort(a) # hide
swapsorttime[2] = @belapsed swapsort(a,b) # hide
swapsorttime[3] = @belapsed swapsort(a,b,c,d) # hide
swapsorttime[4] = @belapsed swapsort(a,b,c,d,e,f,g,h) # hide
swapsorttime[5] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p) # hide
swapsorttime[6] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F) # hide
swapsorttime[7] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Ja,Fe,Ma,Ap,My,Ju,Jl,Au,Se,Oc,No,De) # hide

svectortime[1] = @belapsed sort(SVector(a)) # hide
svectortime[2] = @belapsed sort(SVector(a,b)) # hide
svectortime[3] = @belapsed sort(SVector(a,b,c,d)) # hide
svectortime[4] = @belapsed sort(SVector(a,b,c,d,e,f,g,h)) # hide
svectortime[5] = @belapsed sort(SVector(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p)) # hide
svectortime[6] = @belapsed sort(SVector(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F)) # hide
svectortime[7] = @belapsed sort(SVector(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Ja,Fe,Ma,Ap,My,Ju,Jl,Au,Se,Oc,No,De)) # hide

vectortime[1] = @belapsed sort!([a]) # hide
vectortime[2] = @belapsed sort!([a,b]) # hide
vectortime[3] = @belapsed sort!([a,b,c,d]) # hide
vectortime[4] = @belapsed sort!([a,b,c,d,e,f,g,h]) # hide
vectortime[5] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]) # hide
vectortime[6] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F]) # hide
vectortime[7] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Ja,Fe,Ma,Ap,My,Ju,Jl,Au,Se,Oc,No,De]) # hide

thisplot = plot.scatter(x=samples, y=swapsorttime, name="SwapSort").scatter(x=samples,y=svectortime, name="StaticArrays").scatter(x=samples,y=vectortime, name="Base") # hide
thisplot.layout.xaxis = ( # hide
    type = "log", # hide
    dtick = log10(2), # hide
    title = "N" # hide
) # hide
thisplot.layout.yaxis = ( # hide
    type = "log", # hide
    dtick = 1, # hide
    exponentformat = "power", # hide
    title = "Runtime" # hide
) # hide
to_documenter(thisplot) # hide
```

## Different types (type-unstable)
When sorting across different types, methods based on `Tuple` or `Vararg` suffer from type inference as different orders have different types. As a result, the compilation time can be a lot longer. In this benchmark, we consider up to 23 variables of different types, including
- 7 Number types: Int, Float, Irrational, Complex, Rational, BigInt, BigFloat
- 8 Collection types: Tuple, Set, Dict, Matrix, Vector, String, Range, NamedTuple
- 8 Other types: CartesianIndex, Pair, Function, Symbol, Type, Module, Nothing, Char

Sorting across different types is not supported by StaticArrays.jl, so the benchmark only contains SwapSort and Base.
```@example benchmark3; continued=true
using Random, SwapSort, PlotlyLight, BenchmarkTools, StaticArrays, PlotlyDocumenter
# default(background_color=:transparent, foreground_color=:gray, yaxis=:log, xaxis=:identity, xticks=1:23) # hide
BenchmarkTools.DEFAULT_PARAMETERS.seconds = 0.5 # hide
a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w = shuffle(
    [rand(Int), rand(), Ï€, im, 1//2, BigInt(rand(Int128)), rand(BigFloat), 
    (1,2), Set([1,2]), Dict(1=>2), rand(2,2), rand(Int, 10), randstring(), 1:10, (a=1,b=2), 
    CartesianIndex(1,2), 1=>2, sin, :sin, typeof(sin), SwapSort, nothing, 'a'])
swapsorttime = zeros(23) # hide
vectortime = zeros(23) # hide
```

### Compilation
```@example benchmark3
swapsorttime[1] = @elapsed swapsort(a; by=string) # hide
swapsorttime[2] = @elapsed swapsort(a,b; by=string) # hide
swapsorttime[3] = @elapsed swapsort(a,b,c; by=string) # hide
swapsorttime[4] = @elapsed swapsort(a,b,c,d; by=string) # hide
swapsorttime[5] = @elapsed swapsort(a,b,c,d,e; by=string) # hide
swapsorttime[6] = @elapsed swapsort(a,b,c,d,e,f; by=string) # hide
swapsorttime[7] = @elapsed swapsort(a,b,c,d,e,f,g; by=string) # hide
swapsorttime[8] = @elapsed swapsort(a,b,c,d,e,f,g,h; by=string) # hide
swapsorttime[9] = @elapsed swapsort(a,b,c,d,e,f,g,h,i; by=string) # hide
swapsorttime[10] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j; by=string) # hide
swapsorttime[11] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k; by=string) # hide
swapsorttime[12] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l; by=string) # hide
swapsorttime[13] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m; by=string) # hide
swapsorttime[14] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n; by=string) # hide
swapsorttime[15] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o; by=string) # hide
swapsorttime[16] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p; by=string) # hide
swapsorttime[17] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q; by=string) # hide
swapsorttime[18] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r; by=string) # hide
swapsorttime[19] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s; by=string) # hide
swapsorttime[20] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t; by=string) # hide
swapsorttime[21] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u; by=string) # hide
swapsorttime[22] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v; by=string) # hide
swapsorttime[23] = @elapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w; by=string) # hide

vectortime[1] = @elapsed sort!([a]; by=string) # hide
vectortime[2] = @elapsed sort!([a,b]; by=string) # hide
vectortime[3] = @elapsed sort!([a,b,c]; by=string) # hide
vectortime[4] = @elapsed sort!([a,b,c,d]; by=string) # hide
vectortime[5] = @elapsed sort!([a,b,c,d,e]; by=string) # hide
vectortime[6] = @elapsed sort!([a,b,c,d,e,f]; by=string) # hide
vectortime[7] = @elapsed sort!([a,b,c,d,e,f,g]; by=string) # hide
vectortime[8] = @elapsed sort!([a,b,c,d,e,f,g,h]; by=string) # hide
vectortime[9] = @elapsed sort!([a,b,c,d,e,f,g,h,i]; by=string) # hide
vectortime[10] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j]; by=string) # hide
vectortime[11] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k]; by=string) # hide
vectortime[12] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l]; by=string) # hide
vectortime[13] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m]; by=string) # hide
vectortime[14] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n]; by=string) # hide
vectortime[15] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o]; by=string) # hide
vectortime[16] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]; by=string) # hide
vectortime[17] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q]; by=string) # hide
vectortime[18] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r]; by=string) # hide
vectortime[19] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s]; by=string) # hide
vectortime[20] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t]; by=string) # hide
vectortime[21] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u]; by=string) # hide
vectortime[22] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v]; by=string) # hide
vectortime[23] = @elapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w]; by=string) # hide

thisplot = plot.scatter(x=1:23, y=swapsorttime, name="SwapSort").scatter(x=1:23,y=vectortime, name="Base") # hide
thisplot.layout.yaxis = (
    type = "log",
    dtick = 1,
    exponentformat = "power",
    title = "Compilation"
) # hide
thisplot.layout.xaxis = (
    dtick = 1,
    title = "N"
) # hide
to_documenter(thisplot) # hide
```

### Runtime
```@example benchmark3
swapsorttime[1] = @belapsed swapsort(a; by=string) # hide
swapsorttime[2] = @belapsed swapsort(a,b; by=string) # hide
swapsorttime[3] = @belapsed swapsort(a,b,c; by=string) # hide
swapsorttime[4] = @belapsed swapsort(a,b,c,d; by=string) # hide
swapsorttime[5] = @belapsed swapsort(a,b,c,d,e; by=string) # hide
swapsorttime[6] = @belapsed swapsort(a,b,c,d,e,f; by=string) # hide
swapsorttime[7] = @belapsed swapsort(a,b,c,d,e,f,g; by=string) # hide
swapsorttime[8] = @belapsed swapsort(a,b,c,d,e,f,g,h; by=string) # hide
swapsorttime[9] = @belapsed swapsort(a,b,c,d,e,f,g,h,i; by=string) # hide
swapsorttime[10] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j; by=string) #hide
swapsorttime[11] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k; by=string) # hide
swapsorttime[12] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l; by=string) # hide
swapsorttime[13] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m; by=string) # hide
swapsorttime[14] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n; by=string) # hide
swapsorttime[15] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o; by=string) # hide
swapsorttime[16] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p; by=string) # hide
swapsorttime[17] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q; by=string) # hide
swapsorttime[18] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r; by=string) # hide
swapsorttime[19] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s; by=string) # hide
swapsorttime[20] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t; by=string) # hide
swapsorttime[21] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u; by=string) # hide
swapsorttime[22] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v; by=string) # hide
swapsorttime[23] = @belapsed swapsort(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w; by=string) # hide

vectortime[1] = @belapsed sort!([a]; by=string) # hide
vectortime[2] = @belapsed sort!([a,b]; by=string) # hide
vectortime[3] = @belapsed sort!([a,b,c]; by=string) # hide
vectortime[4] = @belapsed sort!([a,b,c,d]; by=string) # hide
vectortime[5] = @belapsed sort!([a,b,c,d,e]; by=string) # hide
vectortime[6] = @belapsed sort!([a,b,c,d,e,f]; by=string) # hide
vectortime[7] = @belapsed sort!([a,b,c,d,e,f,g]; by=string) # hide
vectortime[8] = @belapsed sort!([a,b,c,d,e,f,g,h]; by=string) # hide
vectortime[9] = @belapsed sort!([a,b,c,d,e,f,g,h,i]; by=string) # hide
vectortime[10] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j]; by=string) # hide
vectortime[11] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k]; by=string) # hide
vectortime[12] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l]; by=string) # hide
vectortime[13] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m]; by=string) # hide
vectortime[14] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n]; by=string) # hide
vectortime[15] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o]; by=string) # hide
vectortime[16] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]; by=string) # hide
vectortime[17] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q]; by=string) # hide
vectortime[18] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r]; by=string) # hide
vectortime[19] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s]; by=string) # hide
vectortime[20] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t]; by=string) # hide
vectortime[21] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u]; by=string) # hide
vectortime[22] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v]; by=string) # hide
vectortime[23] = @belapsed sort!([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w]; by=string) # hide

thisplot = plot.scatter(x=1:23, y=swapsorttime, name="SwapSort").scatter(x=1:23,y=vectortime, name="Base") # hide
thisplot.layout.yaxis = (
    type = "log",
    dtick = 1,
    exponentformat = "power",
    title = "Runtime"
) # hide
thisplot.layout.xaxis = (
    dtick = 1,
    title = "N"
) # hide
to_documenter(thisplot) # hide
```